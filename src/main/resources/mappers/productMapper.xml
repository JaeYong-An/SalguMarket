<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.SalGuMarket.www.repository.ProductMapper">

	<select id="getProductById" resultType="com.SalGuMarket.www.domain.ProductVO">
		SELECT * FROM product
		WHERE pno = #{pno}
	</select>
	
	<insert id="saveProduct">
		INSERT INTO product(title, category, price, content, sell, seller_email)
		VALUES(#{title}, #{category}, #{price}, #{content}, #{sell}, #{sellerEmail})
	</insert>
	
	<select id="getRecentPno" resultType="Long">
		SELECT MAX(pno) FROM product
	</select>

	<update id="modifyWalletAddress">
		UPDATE member SET wallet_address = #{staticBackdropInput}
		WHERE email = #{loginEmail}
	</update>
	
	<select id="getTotalCount" resultType="int">
		SELECT COUNT(pno) FROM product
		<if test="category != null and type == null">
			WHERE category = #{category}
		</if>
		<if test="category != null and type != null">
			WHERE category = #{category}
			<include refid="search"></include>
		</if>
	</select>
	
	<select id="getMySaleList" resultType="com.SalGuMarket.www.domain.ProductVO">
		SELECT * FROM product
		WHERE seller_email = #{email}
		ORDER BY pno DESC
	</select>
	
	<select id="getMyBuyList" resultType="com.SalGuMarket.www.domain.ProductVO">
		SELECT * FROM product
		WHERE buyer_email = #{email}
		ORDER BY pno DESC
	</select>
	
	<update id="updateProductState0">
		UPDATE product SET state = 0
		WHERE pno = #{productId}
	</update>
	
	<update id="updateProductState1">
		UPDATE product SET state = 1
		WHERE pno = #{productId}
	</update>
	
	<update id="updateProductState2">
		UPDATE product SET state = 2
		WHERE pno = #{productId}
	</update>
	
	<update id="updateProductState3">
		UPDATE product SET state = 3
		WHERE pno = #{productId}
	</update>
	
	<!-- 검색 동적 SQL 쿼리문 -->
	<sql id="search">
		<if test="type != null">
			<choose>
				<when test="type == 't'.toString()">
					AND title LIKE CONCAT('%', #{keyword}, '%')
				</when>
				<when test="type == 'w'.toString()">
					AND seller_nick_name LIKE CONCAT('%', #{keyword}, '%')
				</when>
			</choose>
		</if>
	</sql>
	
</mapper>